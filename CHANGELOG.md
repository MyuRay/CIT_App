# CHANGELOG

千葉工業大学学生支援アプリの更新履歴

## [1.17.8+58] - 2025-11-03

### 🛠 改善・メンテナンス
- Play ストア向けリリースのためアプリ版数を `1.17.8+58` へ更新。

## [1.17.7+57] - 2025-10-21

### 🔧 メンテナンス
- Firestore ルールを更新し、学食メニューの閲覧数が正しくインクリメントされるよう調整。
- 学食レビューおよびメニュー追加画面の「メニューを確認」ボタンをテーマ連動で表示。

## [1.17.6+56] - 2025-10-21

### 🔧 メンテナンス
- アプリのバージョン番号を `1.17.6+56` に更新。
- ホーム学バスカードの「ダイヤ一覧」からオフライン版時刻表を開かないよう調整。
- 新規会員登録時に表示名を入力・保存できるよう改善。
- マイページで登録済みの表示名が即座に反映されるように修正。
- 初回起動時はサインアップ画面を既定で表示し、未ログイン状態の導線を見直し。
- 学食レビューにプル・トゥ・リフレッシュを追加し、メニュー閲覧数をカウントして表示。
- 学食レビュー投稿時にユーザープロフィールのレビュー数を自動集計。
- 学食レビューカードから対応キャンパスのメニュー画像を開けるショートカットボタンを追加。

## [1.16.0+46] - 2025-09-20

### ✨ 新機能（ホームウィジェット）
- Android ホーム画面ウィジェットを実装/拡張
  - 週間フル時間割ウィジェット（登録がある場合のみ土曜表示、科目色ドット表示、行タップでアプリ起動）
  - 学バスリアルタイムウィジェット（優先キャンパス順で並び替え、次便の残り分を表示、簡易更新ボタン）

### 👤 マイページ・設定
- 学バス表示の優先キャンパス（津田沼/新習志野）を設定可能に（ホーム学バス表示・ウィジェットに反映）

### 🚌 学バス
- ホーム学バスカードで「当日の次便があるのに終了表示になる」問題を修正（最終便まで当日分を表示）
- キャンパスマップ「詳細」リンクを津田沼キャンパスの公式ページへ修正

### 🗓️ 時間割
- メモ欄のURL自動検出・リンク化（カード表示・詳細ダイアログでタップ可能）
- メモ入力欄に「URLはタップ可能」のヘルパー文言を追加
- 土曜表示時の教室名: セル幅に収まるよう自動縮小（平日は従来サイズ）
- 担当教員の入力を任意に変更

### 📰 掲示板
- クーポン投稿の詳細画面で、クーポンカードをタイトルの上に表示

### 🔧 その他
- バージョン番号/ビルド番号の更新

## [1.16.1+47] - 2025-09-20

### 🔧 メンテナンス
- バージョン番号/ビルド番号の更新（軽微な改善の反映）

## [1.16.2+48] - 2025-09-20

### 🔧 メンテナンス
- バージョン番号/ビルド番号の更新

## [1.16.3+49] - 2025-09-20

### 🔧 メンテナンス
- バージョン番号/ビルド番号の更新

## [1.15.10+45] - 2025-09-19

### 🔧 メンテナンス
- バージョン番号/ビルド番号の更新

## [1.15.9+44] - 2025-09-19

### 🔧 メンテナンス
- バージョン番号/ビルド番号の更新

## [1.15.8+43] - 2025-09-18

### 🔧 メンテナンス
- バージョン番号/ビルド番号の更新

## [1.15.7+42] - 2025-09-18

### 🔧 メンテナンス
- バージョン番号/ビルド番号の更新

## [1.15.6+40] - 2025-09-18

### 🔧 メンテナンス
- バージョン番号の更新のみ（配信用）

## [1.15.5+39] - 2025-09-14

### ✨ 機能・UI
- 新規アカウントの時間割: 未作成時に自動生成せず、明示的に「時間割を作成」ボタンを表示して作成可能に
- ホームの学バス情報: 当日の便が無い場合は「本日の運行は終了しました」を表示（翌日のダイヤを表示しない）

### 🔧 仕様調整・修正
- 時間割ドキュメント: Firestore Rules準拠のため `timeSlots` を Map 形式で保存（読込は List/Map 両対応）
- 時間割読込: `Schedule.fromFirestore` を導入し `doc.id` を `id` のフォールバックに利用
- 学バス: dayType(weekday/saturday/sunday)で当日ダイヤのみ表示・計算するように変更
- 掲示板: 画像選択の解像度・品質を緩和（最大2048px/品質90）

### 📝 その他
- バージョン番号の更新

## [1.15.3+31] - 2025-09-10

### 🔧 改善と修正
- ホームの時間割ウィジェットが再起動なしで更新されるよう改善（ポストフレーム更新・復帰時更新を追加）
- Riverpod依存の初期化タイミングを調整し `dependOnInheritedWidgetOfExactType` エラーを解消
- 認証の復帰時挙動を堅牢化（トークン更新タイムアウト・一時的エラーで即サインアウトしない）
- 学バス管理: 路線に「運行期間」設定/表示を追加（開始日・終了日入力、詳細表示）

## [1.15.4+32] - 2025-09-10

### 🔧 メンテナンス
- バージョン番号の更新のみ（内部調整）

## [1.9.0+19] - 2025-01-26

### 🚌 学バス情報システム追加
- **包括的な学バス管理機能**
  - バス路線・時刻表の完全管理システム
  - 運行期間の柔軟な設定機能
  - 津田沼⇄新習志野キャンパス間の双方向ダイヤ対応
  - 管理者コンソールでの詳細設定機能

### 🏠 ホーム画面学バス情報表示
- **リアルタイム運行状況**
  - 現在の運行状態表示（運行中／運行停止）
  - 運行期間の自動判定・表示
  - 次便時刻の自動計算・表示
  - 路線別時刻表の整理された表示

### 🔧 管理者コンソール強化
- **学バス管理タブ追加**
  - 基本情報・路線・運行期間の3つのタブ構成
  - 直感的な路線管理インターフェース
  - 逆方向路線の自動生成機能
  - 運行期間の視覚的管理

### 📊 高度な運行期間管理
- **柔軟な期間設定**
  - 春学期・秋学期・夏休み等の期間設定
  - 期間の重複・空白期間の自動チェック
  - 現在日時での自動運行判定
  - 期間外時の適切なメッセージ表示

### 🚌 バス情報モデル設計
- **完全なデータ構造**
  - `BusInformation`: メイン情報管理
  - `BusRoute`: 路線・時刻表管理
  - `BusOperationPeriod`: 運行期間管理
  - `BusTimeEntry`: 個別時刻エントリ管理

### ⚡ Firebase連携最適化
- **効率的なデータ管理**
  - リアルタイム同期による即座の更新反映
  - バッチ処理による高速データ操作
  - サブコレクション活用での階層的データ管理
  - キャッシュ機能による高速表示

### 🎯 ユーザー体験向上
- **使いやすいインターフェース**
  - 運行状況の色分け表示
  - 次便時刻の強調表示
  - 路線説明の分かりやすい表示
  - エラー状態の適切なハンドリング

## [1.8.3+18] - 2025-01-26

### 🖼️ 管理者承認画面 画像表示機能追加
- **投稿画像の確認機能**
  - 承認待ち投稿で画像プレビュー表示
  - 「画像あり」バッジで一目で識別可能
  - ワンクリックで画像拡大表示
  - 承認済み投稿でも画像確認可能

### 👁️ 画像プレビュー機能
- **フルスクリーン画像表示**
  - 高解像度画像の詳細確認
  - タップで簡単に閉じる操作
  - 読み込み進行状況表示
  - 画像読み込みエラーハンドリング

### 🎯 管理者体験向上
- **承認判断の効率化**
  - 投稿内容と画像を同時に確認
  - 不適切な画像の迅速な検出
  - 視覚的な判断材料の提供
  - 承認・却下の精度向上

### 🔧 UI/UX改善
- **直感的な操作性**
  - 画像表示ボタンの追加
  - 色分けされた状態表示
  - レスポンシブな画像表示
  - 統一されたデザイン言語

## [1.8.2+17] - 2025-01-26

### 📷 画像アップロード大幅最適化
- **高速化と進行表示**
  - 画像サイズを800×600、品質70%に最適化（約60-80%高速化）
  - リアルタイム進行状況インジケーター追加
  - アップロード状況の詳細表示機能
  - ファイルサイズ表示でユーザー体験向上

### 🚀 Firebase Storage最適化
- **効率的なアップロード処理**
  - キャッシュコントロール設定（1年間キャッシュ）
  - カスタムメタデータ付加でデバッグ性向上
  - タイムアウト設定最適化（2分）
  - バックグラウンド画像削除でUX向上

### 💾 投稿処理改善
- **投稿・編集処理の最適化**
  - 段階的進行表示（準備→アップロード→保存→完了）
  - 新規投稿・編集両方で統一された体験
  - エラーハンドリング強化
  - 処理完了後の自動画面遷移

### 🔧 技術的改善
- **パフォーマンス向上**
  - 並行処理でユーザー待機時間削減
  - メモリ効率改善
  - 不要な同期処理削除

### 🎯 ユーザビリティ向上
- 投稿時の待機時間を大幅短縮
- 進行状況が明確で安心感のある操作体験
- エラー発生時の詳細情報表示

## [1.8.1+16] - 2025-01-26

### 🔐 認証システム大幅強化 (タスクキル対応)
- **強化された認証復元機能**
  - Firebase Auth初期化待機時間を15回×800ms（最大12秒）に延長
  - authStateChanges()ストリームからの認証状態取得機能追加
  - 認証トークンのSharedPreferences保存機能
  - 認証データの自動有効期限チェック（30日間）

### 📱 アプリライフサイクル監視システム
- **完全なライフサイクル管理**
  - アプリ再開時の自動認証状態チェック
  - バックグラウンド復帰時の強制認証確認
  - 最終アクセス時刻の自動更新機能
  - アプリ状態変化のリアルタイム監視

### 🛠️ 開発者ツール拡充
- **認証デバッグ画面強化**
  - タスクキル対応状況の詳細表示
  - アプリライフサイクル監視状況表示
  - 認証トークン更新機能
  - 強制認証チェック機能
  - 最終アクセス時刻更新機能

### 🔧 技術的改善
- **Firebase Auth設定最適化**
  - setPersistence(Persistence.LOCAL)設定強化
  - Firebase Auth設定の詳細確認機能
  - 認証状態復元の確実性向上
  - エラーハンドリング・ログ出力強化

### 🎯 ユーザビリティ向上
- タスクキル後の再ログイン問題を大幅に改善
- アプリの応答性・安定性向上
- デバッグ情報の可視化による問題診断の容易化

## [1.8.0+15] - 2025-01-26

### 🚀 パフォーマンス大幅改善
- **パフォーマンス監視システム**
  - アプリ全体の処理時間自動測定・記録
  - メモリ使用量監視（Android対応）
  - フレームレート監視とパフォーマンス統計
  - 遅い操作の自動検出・レポート

### 💾 高機能キャッシュシステム
- **3層キャッシュアーキテクチャ**
  - メモリキャッシュ（高速アクセス）
  - 永続キャッシュ（アプリ再起動後も保持）
  - ファイルキャッシュ（画像など大容量データ）
- **自動管理機能**
  - TTL（有効期限）による自動クリーンアップ
  - キャッシュサイズ最適化
  - 統計情報とデバッグ機能

### 📱 オフライン対応システム
- **ネットワーク状態監視**
  - リアルタイム接続状態検出
  - オフライン時のUI表示変更
- **オフラインアクション管理**  
  - オフライン時のアクションをキューに保存
  - オンライン復帰時の自動同期
  - 同期進捗の可視化

### ⚡ 起動時間最適化
- **並行初期化システム**
  - サービス初期化の並行実行
  - バックグラウンド遅延読み込み
  - 起動時間30-50%短縮を実現

### 🔧 データベースクエリ最適化
- **最適化された掲示板プロバイダー**
  - 効率的なFirestoreクエリ設計
  - バッチ処理による高速化
  - ページネーション対応
  - インデックス活用による検索高速化

### 🎨 UI/UX改善
- **オフライン対応ウィジェット**
  - オフライン状態の視覚的表示
  - キャッシュデータ表示インジケーター
  - 同期待ちアクション数表示
- **パフォーマンス監視ウィジェット**
  - 開発時のビルド回数監視
  - パフォーマンス問題の早期発見

### 🛠️ 開発者体験向上
- **詳細ログシステム**
  - パフォーマンスメトリクス自動収集
  - エラー追跡とデバッグ情報
  - キャッシュ効率の可視化

## [1.7.0+14] - 2025-01-26

### ✨ 新機能
- **認証永続化システム**
  - タスクキル後の自動再ログイン機能
  - 二重バックアップシステム（Firebase Auth + SharedPreferences）
  - 自動再接続機能（指数バックオフ）
  - 認証状態リアルタイム監視

### 🚀 改善
- **セキュリティ向上**
  - プライバシーポリシー画面追加
  - Google Play Console対応
  - CAMERA権限の詳細説明
  
- **開発者ツール強化**
  - 認証デバッグ画面追加
  - 認証状態の詳細監視
  - 手動リフレッシュ・強制チェック機能

### 🔧 技術的改善
- **認証システム最適化**
  - PersistentAuthProvider実装
  - Firebase Auth初期化の改善
  - 認証状態復元の確実性向上
  - エラーハンドリング強化

### 🛡️ セキュリティ・コンプライアンス
- Google Play Console要件対応
- データ保護・プライバシー説明の明文化
- 権限使用理由の詳細文書化

## [1.6.0+13] - 2025-01-26

### ✨ 新機能
- **パフォーマンス最適化システム**
  - メモ化されたConsumerウィジェット追加
  - セレクティブConsumerでの選択的更新機能
  - デバウンス機能付きConsumer
  - 最適化されたリスト・グリッドConsumer
  - パフォーマンス監視機能

### 🚀 改善
- **通知システム最適化**
  - OptimizedNotificationBadge実装
  - 不要な再構築を削減
  - Firebase Auth認証状態に応じた効率的な表示切り替え
  
- **ユーザーインターフェース改善**
  - ホーム画面の通知バッジを最適化されたものに置き換え
  - メモリ使用量の削減
  - フレームレートの安定化

### 🔧 技術的改善
- **コンポーネント最適化**
  - 条件付きリビルドConsumer
  - パフォーマンス測定ユーティリティ
  - 最適化されたPadding、BorderRadius、Constraints定数
  
- **開発者体験向上**
  - ビルド時間測定機能
  - フレームスキップ監視
  - ウィジェット再構築カウンター

### 🛡️ セキュリティ
- 投稿・コメントの編集・削除権限チェック強化
- 非所有者による不正操作の防止

## [1.5.0+12] - 2025-01-25

### ✨ 新機能
- **通知システム**
  - Firebase Cloud Messaging統合
  - リアルタイム通知配信
  - 投稿・ピン留め承認/却下通知
  - コメント・返信通知

### 🚀 改善
- 掲示板のピン留め申請UIをSwitchListTileに統一
- 投稿編集時の再審査システム
- 管理者権限チェックの改善

### 🐛 バグ修正
- 重複宣言エラーの修正
- プロバイダー呼び出しエラーの解決

---

## バージョン番号について
- **メジャー（x.0.0）**: 大きな機能追加・破壊的変更
- **マイナー（1.x.0）**: 新機能追加・機能改善  
- **パッチ（1.5.x）**: バグ修正・小さな改善
- **ビルド番号（+xx）**: 開発ビルド・内部リリース
